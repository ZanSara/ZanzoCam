<html>
<head>
  <title>ZANZOCAM - Impostazioni</title>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="text/html; charset=ISO-8859-1">
  <link href="milligram.css" rel="stylesheet">
  <script type="text/javascript" src="jszip.js"></script>
  
  <script>  
    var zipFile = null;   // Is the configuration file a ZIP or a JSON?
    var zippedImagesData = {};
    
    /*
     * Get JSON data from the server.
     * Useful if the page is hosted with the JSON on the remote server
     */
    function loadDataFromServer(url){
        fetch(url, { method:'GET'})
        .then(response => response.json())
        .then(json => {
            last_loaded_data = json.configuration;
            fillForm(last_loaded_data, "");
         });
    }
    
    /*
     * Get JSON data from a local file.
     * Useful if this page is running from a local HTML file on an offline machine.
     */
    function loadDataFromFile(form){
        if (form.files.length === 0) {
            alert('Seleziona il file di configurazione da modificare.');
            return;
        }        
        var filename = form.files[0].name;
        var extension = filename.substring(filename.lastIndexOf(".")+1, filename.length);
        if (extension==="zip"){
            loadDataFromZip(form, filename);
        } else {
            loadDataFromJson(form, filename);
        }
    }
    
    /*
     * Get JSON data from a local text file.
     * No images will be available unless the remote server wants to serve them.
     */
    function loadDataFromJson(form, filename){
        // It's a simple JSON file
        const reader = new FileReader();
        reader.onload = function fileReadCompleted() {
            data = JSON.parse(reader.result);
            last_loaded_data = data;
            fillForm(last_loaded_data, "");
        };
        reader.readAsText(form.files[0]);
    }
  
    /*
     * Get JSON data and the images from a local ZIP file.
     * Images should be available in the ZIP file and they can be previewed.
     */
    function loadDataFromZip(form, filename){
        // it's a complete ZIP file with the images
        const reader = new FileReader();
        reader.onload = function fileReadCompleted() {
            var zip = new JSZip();
            zip.loadAsync(reader.result, {createFolders:true})
            .then((zip) => {
            
                // Read the configuration file
                zip.file("configuration.json")
                .async("string")
                .then(content => {
                
                    // Load the configuration file
                    data = JSON.parse(content);
                    zipFile = filename;
                    last_loaded_data = data;
                    fillForm(last_loaded_data, "");
                    
                    // Once done, load all the images contained into it
                    // and replace remote URLs with the local blobs
                    zip.folder("images").forEach((image, data) => {
                        data.async("arraybuffer")
                        .then(
                        function(content) {
                            var buffer = new Uint8Array(content);
                            var blob = new Blob([buffer.buffer]);
                            var imageElement = document.querySelector("img[src*='"+image+"']");
                            imageElement.src = URL.createObjectURL(blob);
                            zippedImagesData[image] = blob;
                        },
                        function(e) {
                            console.log(e);
                            alert("Errore durante la lettura di: "+file.name);
                        });
                    });
                    
                }).catch(error => {
                    console.log(error);
                    alert("Errore durante il caricamento! Sei sicuro di aver "+
                          "selezionato il file zip corretto? Il file deve "+
                          "contenere un file di nome 'configuration.json' e " +
                          "una cartella chiamata 'images' per essere caricato "+
                          "correttamente.");
                });
            });
        };
        reader.readAsArrayBuffer(form.files[0]);
    }
  
  
    /*
     * Load local images to render them in the configuration file.
     * Used to preview a new image that has been selected but is neither online
     * not in the zip yet.
     */
    function loadLocalImage(filePicker) {
        const reader = new FileReader();
        reader.onload = function fileReadCompleted() {
            document.getElementById(filePicker.name).src = reader.result;
        };
        reader.readAsDataURL(filePicker.files[0]);
    }

    /*
     * Loads the JSON data into the form.
     */
    function fillForm(data, prefix){
        // Hide the loading box and display the main form
	    document.getElementById("loading").style.display="none";  
	    document.getElementById("main-form").style.display="block"; 

	    // Get all the form input elements
	    const { elements } = document.querySelector('form');
        
        for (const [ key, value ] of Object.entries(data) ) {
            // Nested objects should be processed recursively
	        if (typeof value === 'object' & value !== null){
                fillForm(value, prefix+key+"__");
	        }
            // Check if there is an input field matching the name of the data field	        
            const field = elements.namedItem(prefix+key)
            if (field){
                // If the value is a Boolean, the field should be a checkbox: check it                     
	            if (field.type === 'checkbox'){
		            field.checked = value ? true : false; 
	            
                // Handle radioboxes and multiple checkboxes with the same name.                   
	            }if (!field.type && field[0].type==="checkbox"){
	                field.forEach((f) => {
    		            f.checked = value ? true : false; 
	                });
	            
                // If it's a file picker, render the image in the nearby box
                } else if(field.type === "file"){
                    if (localMode){
                        server_url = document.getElementById("server-url").value;
                        document.getElementById(prefix+key).alt = "Preview non disponibile in modalita' offline";
                        document.getElementById(prefix+key).src = server_url + "pannello/config/images/" + value;
                    } else {
                        document.getElementById(prefix+key).src = url + "pannello/config/images/" + value;
                    }
                    document.getElementById(prefix+key+"_current").innerHTML = "<b>"+value+"</b>";
                // If it's not an object, you can safely fill the value in
                } else {
                    field.value = value
                }
            }
            // Special processing is needed for the server protocol radio switch
	        if (prefix === "server__" &&  key === "protocol"){
	            toggle_server_protocol(value);
	        }
	        // Special processing is needed for the overlay type radio switch
	        prefixes = prefix.split("__");
	        if (prefixes[0] === "overlays" &&  key === "type"){
	            toggle_type_of_overlay(prefixes[1], value);
	        }
            // Special processing is needed for color fields
            if (key === "font_color" || key === "background_color"){
                dropdown = document.getElementById(prefix+key);
	            setColorField(dropdown.previousElementSibling, value, prefix+key);
            }
        }
    }


    /*
     * Sets a value in a deep object given a flat key. Separator: "__"
     */
	function deepSet(key, value, obj){
        var i;
	    key = key.split('__');
	    for (i = 0; i < key.length - 1; i++){
		    if (typeof obj[key[i]] === "undefined"){
		        obj[key[i]] = {};
            }
            obj = obj[key[i]];
	    }
	    obj[key[i]] = value;
	}
	
    /*
     * Gets a value from a deep object given a flat key. Separator: "__"
     */
	function deepGet(key, obj){
        var i;
	    key = key.split('__');
	    for (i = 0; i < key.length - 1; i++){
		    if (typeof obj[key[i]] === "undefined"){
                obj[key[i]] = {};
		    }
            obj = obj[key[i]];        
        }
	    return obj[key[i]];
	}

    /*
     * Converts the form data into a nested JSON object 
     * ready to be sent to the server or returned to the user.
     */
    function formdataToJson(formData){
        var object = {};
        const form = document.getElementById('config');
        Array.from(form.elements).forEach((field) => {
            key = field.name;
            value = formData.get(key);
            
            // Fields that are hidden should not be processed
            // but radios might be hidden by CSS to make the button style
            if (!field.offsetParent && field.type !== "radio") { return; }
            
            // Empty strings are null
            if (value===""){ value = null; }
            
            // Checkboxes are boolean and have their value in the checked attribute
            if (field.type === "checkbox"){
                value = field.checked ? true: false; 
            }
            // This is a file that has not been changed.
            // Be sure to re-send the old value, or it will clear the field.        
            if (value===null && field.type === "file"){
                value = deepGet(key, last_loaded_data);
            }
            if (value !== null && value !== "" && typeof value !== 'undefined'){ 
	            // Get the proper value from filepickers
	            if (value instanceof File) {
                    value = value.name;
                }
	            // Actually set the value
                deepSet(key, value, object);
	        }
        });
        filtered_object = object
        return filtered_object;
    }


    /*
     * Saves the configuration either by sending it to the remote server 
     * (if hosted on the remote server) or by letting the user download it 
     * (if running offline).
     */
    function saveConfiguration(url){
        const form = document.getElementById('config');
        const save = document.getElementById('save');
        save.disabled = true;        
        
        // Serialize the content of the form in a JSON file
        const data = new FormData(form);
        const object = formdataToJson(data);
        serialized = JSON.stringify(object, null, "  ");
        
        // Create a new form with the JSON of the config and all the images
        var formdata = new FormData();
        var images = []
        formdata.append("config", serialized);
        // Get all the images specified in the form
        for(ver of ['top', 'bottom']) {
            for(hor of ['right', 'center', 'left']){
                var field = "overlays__"+ver+"_"+hor+"__path";
                if (data.has(field)){
                    var imageElement = document.getElementById(field);
                    formdata.append(field, data.get(field));
                    images.push(imageElement.src);
                }
            }
        }
	    // Send the JSON to the server or ask the user to save it locally
        if (localMode){
            if (zipFile){
                saveConfigurationToZip(formdata, images);
            } else {
                saveConfigurationToJson(formdata);
            }
        } else {
	        saveConfigurationToServer(formdata);
        }
        save.disabled = false;  
    };
    
    /*
     * Send the updated JSON with the pictures on the server.
     */
    function saveConfigurationToServer(formdata){
        fetch(url, {
            method:'POST',
            body: formdata,
        })
        .then(response => response.json())
        .then(reply => {
            loadDataFromServer(url);
        });
    }
    
    /*
     * Let the user download the ZIP file containing the JSOn and the images.
     */
    function saveConfigurationToZip(formdata, images){
        var zip = new JSZip();
        zip.file("configuration.json", serialized);
        var img = zip.folder("images");
    
        var imagePickers = Array.from(document.querySelectorAll('.image-picker'));
        imagePickers.forEach((item) => {
                
            // If the filepicker contains something, save it
            if (item.files.length > 0){
                img.file(item.files[0].name, item.files[0], {base64: true});
                
            // Otherwise, make sure to preserve whatever image the previous 
            // config file came with.
            } else {

                var imageElement = document.getElementById(item.name);
                var imageName = document.getElementById(item.name+"_current").textContent;
                
                if (imageElement && imageElement.src){
                    if(imageElement.src.startsWith("blob:")){
                        // it's a blob: read from the original ZIP
                        img.file(imageName, zippedImagesData[imageName]);
                                    
                    } else {
                        // In any other case we assume it's a URL, so try to
                        // download it.
                        fetch(imageElement.src)
                        .then(function(response) {
                            return response.blob();
                        })
                        .then(function(blob) {
                            img.file(item.value, blob, {base64: true});
                        })
                        .catch((error) => {
                            alert("Errore durante il salvataggio di "+
                                imageElement.src +" Aggiungi manualmente questa "+
                                "immagine sul server!");
                        });
                    }
                }
            }
        });
        zip.generateAsync({type:"blob"}).then(function(content) {
            var download = document.createElement('a');
            download.setAttribute("href", URL.createObjectURL(content));
            download.setAttribute("download", "configuration.zip");
            document.body.appendChild(download); // required for firefox
            download.click();
            download.remove();
        });
    }
    
    /*
     * Let the user download the JSON file, without the images.
     */
    function saveConfigurationToJson(formdata) {
        var dataString = "data:text/json;charset=utf-8," + encodeURIComponent(serialized);                
        var download = document.createElement('a');
        download.setAttribute("href", dataString);
        download.setAttribute("download", "configuration.json");
        document.body.appendChild(download); // required for firefox
        download.click();
        download.remove();
        alert("ATTENZIONE! Assicurati che sul server siano presenti "+
              "tutte le immagini specificate nel file di configurazione!")
    }
        
    
    // Toggle http or ftp in the server section
    function toggle_server_protocol(value) {
        var http_block = document.getElementById("server_protocol_HTTP-vars");
        var ftp_block = document.getElementById("server_protocol_FTP-vars");
        http_block.style.display = value==="HTTP" ? "block" : "none";
        ftp_block.style.display = value==="FTP" ? "block" : "none";
    }
    
    // Toggle text or image config in the overlays section
    function toggle_type_of_overlay(position, value) {
        var text_block = document.getElementById(position+"_text-vars");
        var image_block = document.getElementById(position+"_image-vars");
        text_block.style.display = value==="text" ? "block" : "none";
        image_block.style.display = value==="image" ? "block" : "none";
    }

    // Sets a background and a text color to a color input field
    function setColorField(fieldToColor, color, dropdownToReset){
        if (dropdownToReset){
            document.getElementById(dropdownToReset).selectedIndex = 0; 
        }
        textcolor = computeContrastyTextColor(color);
        if (textcolor == null){
            // The color input is not complete yet: go back to white-black
            fieldToColor.style.color = 'black'
            fieldToColor.style.backgroundColor = 'white';
            return
        }
        fieldToColor.value = color;
        fieldToColor.style.color = textcolor;
        fieldToColor.style.backgroundColor = color;
    }

    // Computes a visible color for the text in a color field (returns either black or white)
    function computeContrastyTextColor(backgroundColor){
        black = [0, 0, 0];
        white = [255, 255, 255];
        if (backgroundColor.length == 9){
            bg = mergeAlphaToWhite(hex2rgba(backgroundColor));
        } else if(backgroundColor.length == 7){
            bg = hex2rgb(backgroundColor);
        } else {
            return null;
        }
        blackContrast = contrast(black, bg);
        whiteContrast = contrast(white, bg);
        if (whiteContrast > blackContrast){
            return "white";
        }
        return "black";
    }

    // Compute the rgb representation of an rgba value on white background
    function mergeAlphaToWhite(rgba){
        r = rgba[0]/255;
        g = rgba[1]/255;
        b = rgba[2]/255;
        a = rgba[3]/255;
        return [
            // Formula: Target.R = ((1 - Source.A) * BGColor.R) + (Source.A * Source.R)    (replace R with G, B to get the other two channels)
            // BGColor is white, so [1, 1, 1]
            (((1 - a) * 1) + (a * r)) * 255,
            (((1 - a) * 1) + (a * g)) * 255,
            (((1 - a) * 1) + (a * b)) * 255
        ];
    }
    
    // Converts #hexcolors into [r, g, b] arrays
    function hex2rgb(hex) {
        var validHEXInput = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        if (!validHEXInput) {
            return false;
        }
        return [
            parseInt(validHEXInput[1], 16),
            parseInt(validHEXInput[2], 16),
            parseInt(validHEXInput[3], 16)
        ];
    }
    // Converts #hexcolors into [r, g, b, a] arrays
    function hex2rgba(hex) {
        var validHEXInput = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        if (!validHEXInput) {
            return false;
        }
        return [
            parseInt(validHEXInput[1], 16),
            parseInt(validHEXInput[2], 16),
            parseInt(validHEXInput[3], 16),
            parseInt(validHEXInput[4], 16)
        ];
    }
    // Computes contrast between two [r, g, b] arrays
    function contrast(rgb1, rgb2) {
        var lum1 = luminance(rgb1[0], rgb1[1], rgb1[2]);
        var lum2 = luminance(rgb2[0], rgb2[1], rgb2[2]);
        var brightest = Math.max(lum1, lum2);
        var darkest = Math.min(lum1, lum2);
        return (brightest + 0.05)
            / (darkest + 0.05);
    }
    // Computes the luminance of a [r, g, b] color
    function luminance(r, g, b) {
        var a = [r, g, b].map(function (v) {
            v /= 255;
            return v <= 0.03928
                ? v / 12.92
                : Math.pow( (v + 0.055) / 1.055, 2.4 );
        });
        return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
    }
    


  </script>

</head>
<body class="sky">
	<div class="cloud x1"></div>
	<div class="cloud x2"></div>
	<div class="cloud x3"></div>
	<div class="cloud x4"></div>
	<div class="cloud x5"></div>
	<div class="cloud x6"></div>
	<div class="cloud x7"></div>
	<div class="cloud x11"></div>
	<div class="cloud x12"></div>
	<div class="cloud x13"></div>
	<div class="cloud x14"></div>
	<div class="cloud x15"></div>
	<div class="cloud x16"></div>
	<div class="cloud x17"></div>

<div id="container">
    
    <div class="center">
        <h2>Impostazioni</h2>
        <h1>ZANZOCAM</h1>
    </div>
    
    <div id="loading" class="center">
        <hr />
        <h2>Caricamento...</h2>
        <hr />
    </div>
    
    <div id="loading-local" class="sheet" style="display: none;">
        <h3>Scegli il file di configurazione da modificare:</h3>
        <input type="file" id="configFile">
    </div>
    
    <div id="main-form" style="display:none;">
    
        <form id="config">
            <div class="sheet">
                <div class="row">
                    <h3>Server:</h3>
                    <label class="toggle">
                        <input type="radio" value="HTTP" name="server__protocol" onclick="javascript:toggle_server_protocol('HTTP')">
                        <span class="label">HTTP</span>
                    </label><br>
                    <label class="toggle">
                        <input type="radio" value="FTP" name="server__protocol" checked onclick="javascript:toggle_server_protocol('FTP')">
                        <span class="label">FTP</span>
                    </label><br>
                </div> 
                
                <div id="server_protocol_HTTP-vars">
                    <label for="server__url">URL del server:</label>
                    <input type="text" placeholder="https://example.com/foto" id="server-url" name="server__url">
                </div>
                
                <div id="server_protocol_FTP-vars" style="display: none;">
                    <label for="server__hostname">Hostname:</label>
                    <input type="text" placeholder="example.com" id="server-hostname" name="server__hostname">
                </div>
                
                <label for="server__username">Username (se necessario):</label>
                <input type="text" placeholder="username"  name="server__username">
                
                <label for="server__password">Password (se necessaria):</label>
                <input type="text" placeholder="password"  name="server__password">
            </div>
            
            <div class="sheet">
                <h3>Orario:</h3>

                <div class="row">
                    <div class="column">
                        <label class="label-inline">Inizia a scattare alle:</label>
                        <input type="text" placeholder="00:01" name="time__start_activity">
                    </div>
                    <div class="column">
                        <label class="label-inline">Smetti di scattare alle:</label>
                        <input type="text" placeholder="23:59" name="time__stop_activity">
                    </div>
                    <div class="column">
                        <label class="label-inline">Frequenza scatti:</label>
                        <select name="time__frequency">
                          <option value=5 >Ogni 5 minuti</option>
                          <option value=15 >Ogni 15 minuti</option>
                          <option value=30 >Ogni 30 minuti</option>
                          <option value=60 selected="selected">Ogni ora</option>
                          <option value=120 >Ogni 2 ore</option>
                          <option value=240 >Ogni 4 ore</option>
                          <option value=480 >Ogni 8 ore</option>
                        </select>
                    </div>
                </div>

                <details>
                    <summary>Modalita' esperto (configuratione crontab diretta)</summary>
                    
                    <p>
                    <br>
                    <b>NOTA BENE:</b> se anche uno solo di questi campi contiene un valore, 
                    la frequenza definita sopra verra' ignorata.
                    </p>
                    <div class="row">
                        <div class="column">
                            <label class="label-inline">Minuti:</label>
                            <input type="text" placeholder="*"  name="crontab__minute">
                        </div>
                        <div class="column">
                            <label class="label-inline">Ora:</label>
                            <input type="text" placeholder="*"  name="crontab__hour">
                        </div>
                        <div class="column">
                            <label class="label-inline">Giorno:</label>
                            <input type="text" placeholder="*"  name="crontab__day">
                        </div>
                        <div class="column">
                            <label class="label-inline">Mese:</label>
                            <input type="text" placeholder="*"  name="crontab__month">
                        </div>
                        <div class="column">
                            <label class="label-inline">G. settimana:</label>
                            <input type="text" placeholder="*"  name="crontab__weekday">
                        </div>
                    </div>
                </details>
            </div>
            
     <!-------------------------------------------------------------------------->
        
            <div class="sheet">
                <h3>Foto:</h3>
                
                <div class="row">
                    <div class="column column-75">
                        <label for="image__name">Nome:</label>
                        <input type="text" placeholder="foto"  name="image__name">
                    </div>
                    <div class="column">
                        <label for="image__extension">Estensione:</label>
                        <select name="image__extension">
                          <option value="jpg" selected="selected">JPG</option>
                          <option value="png">PNG</option>
                          <option value="gif">GIF</option>
                        </select>
                    </div>
                </div>
                
                <input type="checkbox"  name="image__add_date_to_name">
                <label class="label-inline" for="image__add_date_to_name">Aggiungi la data al nome della foto</label>
                <br>
                
                <input type="checkbox"  name="image__add_time_to_name">
                <label class="label-inline" for="image__add_time_to_name">Aggiungi l'ora al nome della foto</label>
                <br>
                <br>
                
                <div class="row">
                    <div class="column">
                        <label for="image__width">Larghezza:</label>
                        <input type="text" placeholder="2592"  name="image__width">
                    </div>
                    <div class="column">
                        <label for="image__height">Altezza:</label>
                        <input type="text" placeholder="1944"  name="image__height">
                    </div>
                </div>
                
                <div class="row">
                    <div class="column">
                        <input type="checkbox"  name="image__hor_flip">
                        <label class="label-inline" for="image__hor_flip">Speccha in orizzontale</label>
                        <br>            
                        <br>
                    </div>
                    <div class="column">
                        <input type="checkbox"  name="image__ver_flip">
                        <label class="label-inline" for="image__ver_flip">Specchia in verticale</label>
                        <br>
                        <br>
                    </div>
                </div>
                        
                <div class="row">
                    <div class="column">
                        <label>Angolo Rotazione:</label>
                        <input type="text" placeholder="0"  name="image__rotation">
                    </div>
                    <div class="column">
                        <label>Colore Sfondo (RGBA):</label>
                        <span>
                            <input value="" name="image__background_color" oninput="setColorField(this, this.value, 'image__background_color');"/>
                            <select id="image__background_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                <option value=""></option>
                                <option value="#ffffff">bianco</option>
                                <option value="#cccccc">grigio chiaro</option>
                                <option value="#999999">grigio</option>
                                <option value="#333333">grigio scuro</option>
                                <option value="#000000">nero</option>
                                <option value="#ff0000">rosso</option>
                                <option value="#ffff00">giallo</option>
                                <option value="#008000">verde</option>
                                <option value="#0000ff">blu</option>
                                <option value="#00000088">nero semitrasparente</option>
                                <option value="#ffffff88">bianco semitrasparente</option>
                            </select>
                        </span>
                    </div>
                </div>
                
                <label>Se JPEG:</label>
                <div class="row">
                    <div class="column">
                        <label class="label-inline">Qualita':</label>
                        <input type="text" placeholder="90"  name="image__jpeg_quality">
                    </div>
                    <div class="column">
                        <label class="label-inline">Subsampling:</label>
                        <input type="text" placeholder="0"  name="image__jpeg_subsampling">
                    </div>
                </div>
            </div>
                
            <div class="sheet">
                <h3>Testo e Immagini:</h3>

 <!-------------------------------------------------------------------------->
                <div class="sheet-inner">
                    <div class="row">
                        <h4>In alto a destra</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__top_right__type" checked onclick="javascript:toggle_type_of_overlay('top_right', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__top_right__type" onclick="javascript:toggle_type_of_overlay('top_right', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__top_right__type" onclick="javascript:toggle_type_of_overlay('top_right', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div> 
                    
                    <div id="top_right_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="overlays__top_right__text">Testo</label>
                        <textarea placeholder="Testo..." name="overlays__top_right__text"></textarea>
                        
                        
                        <div class="row">
                            <div class="column">
                                <label for="overlays__top_right__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__top_right__font_color" oninput="setColorField(this, this.value, 'overlays__top_right__font_color');"/>
                                    <select id="overlays__top_right__font_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                            <div class="column">
                                <label for="overlays__top_right__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__top_right__background_color" oninput="setColorField(this, this.value, 'overlays__top_right__background_color');"/>
                                    <select id="overlays__top_right__background_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__top_right__font_size">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__top_right__over_the_picture">
                                <label class="label-inline" for="overlays__top_right__over_the_picture">Dentro il perimetro della foto</label>
                                <br> 
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Formato Data (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%d %B %Y"  name="overlays__top_right__date_format">
                            </div>
                            <div class="column">
                                <label>Formato Ora (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%H:%M"  name="overlays__top_right__time_format">
                            </div>
                        </div>
                    </div>
                    
                    <div id="top_right_image-vars"  class="overlay-fields" style="display: none;">
                        <div class="row">
                            <div class="column">
                                <label>Immagine Attuale: <span id="overlays__top_right__path_current"></span></label>
                                <img id="overlays__top_right__path" height="200"></img>
                            </div>
                            <div class="column vertical-center">
                                <label>Cambia immagine</label>
                                <input type="file" class="image-picker" name="overlays__top_right__path">
                            </div>
                        </div>
                           
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" placeholder="100"  name="overlays__top_right__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" placeholder="100"  name="overlays__top_right__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="20"  name="overlays__top_right__padding_ratio">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__top_right__over_the_picture">
                                <label class="label-inline" for="overlays__top_right__over_the_picture">Dentro il perimetro della foto</label>
                                <br>                    
                            </div>
                        </div>
                    </div>
                    
                </div>
                
     <!-------------------------------------------------------------------------->
                
               <div class="sheet-inner">
  
                   <div class="row">
                        <h4>In alto al centro</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__top_center__type" checked onclick="javascript:toggle_type_of_overlay('top_center', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__top_center__type" onclick="javascript:toggle_type_of_overlay('top_center', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__top_center__type" onclick="javascript:toggle_type_of_overlay('top_center', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div> 
                    
                    <div id="top_center_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="top_center_text-content">Testo</label>
                        <textarea placeholder="Testo..." name="overlays__top_center__text"></textarea>
                        
                         <div class="row">
                            <div class="column">
                                <label for="overlays__top_center__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__top_center__font_color" oninput="setColorField(this, this.value, 'overlays__top_center__font_color');"/>
                                    <select id="overlays__top_center__font_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                            <div class="column">
                                <label for="overlays__top_center__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__top_center__background_color" oninput="setColorField(this, this.value, 'overlays__top_center__background_color');"/>
                                    <select id="overlays__top_center__background_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__top_center__font_size">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__top_center__over_the_picture">
                                <label class="label-inline" for="overlays__top_center__over_the_picture">Dentro il perimetro della foto</label>
                                <br> 
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Formato Data (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%d %B %Y"  name="overlays__top_center__date_format">
                            </div>
                            <div class="column">
                                <label>Formato Ora (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%H:%M"  name="overlays__top_center__time_format">
                            </div>
                        </div>
                    </div>                
         
                    <div id="top_center_image-vars"  class="overlay-fields" style="display: none;">
                        <div class="column">
                            <label>Immagine Attuale: <span id="overlays__top_center__path_current"></span></label>
                            <img id="overlays__top_center__path" height="200"></img>
                        </div>
                        <div class="column vertical-center">
                            <label>Cambia immagine</label>
                            <input type="file" class="image-picker" name="overlays__top_center__path">
                        </div>
                            
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" placeholder="100"  name="overlays__top_center__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" placeholder="100"  name="overlays__top_center__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="20"  name="overlays__top_center__padding_ratio">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__top_center__over_the_picture">
                                <label class="label-inline" for="overlays__top_center__over_the_picture">Dentro il perimetro della foto</label>
                                <br>                    
                            </div>
                        </div>
                    </div>
                </div>

     <!-------------------------------------------------------------------------->
                
               <div class="sheet-inner">
 
                   <div class="row">
                        <h4>In alto a sinistra</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__top_left__type" checked onclick="javascript:toggle_type_of_overlay('top_left', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__top_left__type" onclick="javascript:toggle_type_of_overlay('top_left', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__top_left__type" onclick="javascript:toggle_type_of_overlay('top_left', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div> 

                    <div id="top_left_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="top_left_text-content">Testo</label>
                        <textarea placeholder="Testo..." name="overlays__top_left__text"></textarea>
                        
                         <div class="row">
                            <div class="column">
                                <label for="overlays__top_left__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__top_left__font_color" oninput="setColorField(this, this.value, 'overlays__top_left__font_color');"/>
                                    <select id="overlays__top_left__font_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                            <div class="column">
                                <label for="overlays__top_left__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__top_left__background_color" oninput="setColorField(this, this.value, 'overlays__top_left__background_color');"/>
                                    <select id="overlays__top_left__background_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__top_left__font_size">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__top_left__over_the_picture">
                                <label class="label-inline" for="overlays__top_left__over_the_picture">Dentro il perimetro della foto</label>
                                <br> 
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Formato Data (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%d %B %Y"  name="overlays__top_left__date_format">
                            </div>
                            <div class="column">
                                <label>Formato Ora (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%H:%M"  name="overlays__top_left__time_format">
                            </div>
                        </div>
                    </div>                
         
                    <div id="top_left_image-vars"  class="overlay-fields" style="display: none;">
                        <div class="column">
                            <label>Immagine Attuale: <span id="overlays__top_left__path_current"></span></label>
                            <img id="overlays__top_left__path" height="200"></img>
                        </div>
                        <div class="column vertical-center">
                            <label>Cambia immagine</label>
                            <input type="file" class="image-picker" name="overlays__top_left__path">
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" placeholder="100"  name="overlays__top_left__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" placeholder="100"  name="overlays__top_left__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="20"  name="overlays__top_left__padding_ratio">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__top_left__over_the_picture">
                                <label class="label-inline" for="overlays__top_left__over_the_picture">Dentro il perimetro della foto</label>
                                <br>                    
                            </div>
                        </div>
                    </div>
                </div>

     <!-------------------------------------------------------------------------->
                
                <div class="sheet-inner">
                    <div class="row">
                        <h4>In basso a destra</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__bottom_right__type" checked onclick="javascript:toggle_type_of_overlay('bottom_right', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__bottom_right__type" onclick="javascript:toggle_type_of_overlay('bottom_right', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__bottom_right__type" onclick="javascript:toggle_type_of_overlay('bottom_right', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div>

                    <div id="bottom_right_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="bottom_right_text-content">Testo</label>
                        <textarea placeholder="Testo..." name="overlays__bottom_right__text"></textarea>
                        
                        <div class="row">
                            <div class="column">
                                <label for="overlays__bottom_right__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__bottom_right__font_color" oninput="setColorField(this, this.value, 'overlays__bottom_right__font_color');"/>
                                    <select id="overlays__bottom_right__font_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                            <div class="column">
                                <label for="overlays__bottom_right__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__bottom_right__background_color" oninput="setColorField(this, this.value, 'overlays__bottom_right__background_color');"/>
                                    <select id="overlays__bottom_right__background_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__bottom_right__font_size">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__bottom_right__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_right__over_the_picture">Dentro il perimetro della foto</label>
                                <br> 
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Formato Data (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%d %B %Y"  name="overlays__bottom_right__date_format">
                            </div>
                            <div class="column">
                                <label>Formato Ora (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%H:%M"  name="overlays__bottom_right__time_format">
                            </div>
                        </div>
                    </div>                
         
                    <div id="bottom_right_image-vars"  class="overlay-fields" style="display: none;">
                        <div class="column">
                            <label>Immagine Attuale: <span id="overlays__bottom_right__path_current"></span></label>
                            <img id="overlays__bottom_right__path" height="200"></img>
                        </div>
                        <div class="column vertical-center">
                            <label>Cambia immagine</label>
                            <input type="file" class="image-picker" name="overlays__bottom_right__path">
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" placeholder="100"  name="overlays__bottom_right__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" placeholder="100"  name="overlays__bottom_right__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="20"  name="overlays__bottom_right__padding_ratio">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__bottom_right__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_right__over_the_picture">Dentro il perimetro della foto</label>
                                <br>                    
                            </div>
                        </div>
                    </div>  
                </div>

     <!-------------------------------------------------------------------------->
                
                <div class="sheet-inner">
                    <div class="row">
                        <h4>In basso al centro</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__bottom_center__type" checked onclick="javascript:toggle_type_of_overlay('bottom_center', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__bottom_center__type" onclick="javascript:toggle_type_of_overlay('bottom_center', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__bottom_center__type" onclick="javascript:toggle_type_of_overlay('bottom_center', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div>
                    
                    <div id="bottom_center_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="bottom_center_text-content">Testo</label>
                        <textarea placeholder="Testo..." name="overlays__bottom_center__text"></textarea>
                        
                         <div class="row">
                            <div class="column">
                                <label for="overlays__bottom_center__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__bottom_center__font_color" oninput="setColorField(this, this.value, 'overlays__bottom_center__font_color');"/>
                                    <select id="overlays__bottom_center__font_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                            <div class="column">
                                <label for="overlays__bottom_center__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__bottom_center__background_color" oninput="setColorField(this, this.value, 'overlays__bottom_center__background_color');"/>
                                    <select id="overlays__bottom_center__background_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__bottom_center__font_size">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__bottom_center__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_center__over_the_picture">Dentro il perimetro della foto</label>
                                <br> 
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Formato Data (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%d %B %Y"  name="overlays__bottom_center__date_format">
                            </div>
                            <div class="column">
                                <label>Formato Ora (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%H:%M"  name="overlays__bottom_center__time_format">
                            </div>
                        </div>
                    </div>                
         
                    <div id="bottom_center_image-vars"  class="overlay-fields" style="display: none;">
                        <div class="column">
                            <label>Immagine Attuale: <span id="overlays__bottom_center__path_current"></span></label>
                            <img id="overlays__bottom_center__path" height="200"></img>
                        </div>
                        <div class="column vertical-center">
                            <label>Cambia immagine</label>
                            <input type="file"  class="image-picker" name="overlays__bottom_center__path">
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" placeholder="100"  name="overlays__bottom_center__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" placeholder="100"  name="overlays__bottom_center__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="20"  name="overlays__bottom_center__padding_ratio">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__bottom_center__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_center__over_the_picture">Dentro il perimetro della foto</label>
                                <br>                    
                            </div>
                        </div>
                    </div> 
                </div> 

     <!-------------------------------------------------------------------------->
                
                <div class="sheet-inner">
                    <div class="row">
                        <h4>In basso a sinistra</h4>
                        <label class="toggle">
                            <input type="radio" value="" name="overlays__bottom_left__type" checked onclick="javascript:toggle_type_of_overlay('bottom_left', 'neither')">
                            <span class="label">Niente</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="text" name="overlays__bottom_left__type" onclick="javascript:toggle_type_of_overlay('bottom_left', 'text')">
                            <span class="label">Testo</span>
                        </label><br>
                        <label class="toggle">
                            <input type="radio" value="image" name="overlays__bottom_left__type" onclick="javascript:toggle_type_of_overlay('bottom_left', 'image')">
                            <span class="label">Immagine</span>
                        </label><br>
                    </div>
                    
                    <div id="bottom_left_text-vars"  class="overlay-fields" style="display: none;">
                        <label for="bottom_left_text-content">Testo</label>
                        <textarea placeholder="Testo..." name="overlays__bottom_left__text"></textarea>
                        
                        <div class="row">
                            <div class="column">
                                <label for="overlays__bottom_left__font_color">Colore Testo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__bottom_left__font_color" oninput="setColorField(this, this.value, 'overlays__bottom_left__font_color');"/>
                                    <select id="overlays__bottom_left__font_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                            <div class="column">
                                <label for="overlays__bottom_left__background_color">Colore Sfondo (RGBA):</label>
                                <span>
                                    <input value="" name="overlays__bottom_left__background_color" oninput="setColorField(this, this.value, 'overlays__bottom_left__background_color');"/>
                                    <select id="overlays__bottom_left__background_color" onchange="setColorField(this.previousElementSibling, this.value);">
                                        <option value=""></option>
                                        <option value="#ffffff">bianco</option>
                                        <option value="#cccccc">grigio chiaro</option>
                                        <option value="#999999">grigio</option>
                                        <option value="#333333">grigio scuro</option>
                                        <option value="#000000">nero</option>
                                        <option value="#ff0000">rosso</option>
                                        <option value="#ffff00">giallo</option>
                                        <option value="#008000">verde</option>
                                        <option value="#0000ff">blu</option>
                                        <option value="#00000088">nero semitrasparente</option>
                                        <option value="#ffffff88">bianco semitrasparente</option>
                                    </select>
                                </span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Dimensione del font:</label>
                                <input type="text" placeholder="30"  name="overlays__bottom_left__font_size">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__bottom_left__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_left__over_the_picture">Dentro il perimetro della foto</label>
                                <br> 
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Formato Data (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%d %B %Y"  name="overlays__bottom_left__date_format">
                            </div>
                            <div class="column">
                                <label>Formato Ora (<a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes">formato</a>):</label>
                                <input type="text" placeholder="%H:%M"  name="overlays__bottom_left__time_format">
                            </div>
                        </div>
                    </div>                
         
                    <div id="bottom_left_image-vars"  class="overlay-fields" style="display: none;">
                        <div class="column">
                            <label>Immagine Attuale: <span id="overlays__bottom_left__path_current"></span></label>
                            <img id="overlays__bottom_left__path" height="200"></img>
                        </div>
                        <div class="column vertical-center">
                            <label>Cambia immagine</label>
                            <input type="file" class="image-picker" name="overlays__bottom_left__path">
                        </div>

                        <div class="row">
                            <div class="column">
                                <label>Larghezza:</label>
                                <input type="text" placeholder="100"  name="overlays__bottom_left__width">
                            </div>
                            <div class="column">
                                <label>Altezza:</label>
                                <input type="text" placeholder="100"  name="overlays__bottom_left__height">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="column">
                                <label>Margine (% dim. immagine):</label>
                                <input type="text" placeholder="20"  name="overlays__bottom_left__padding_ratio">
                            </div>
                            <div class="column">
                                <br>
                                <input type="checkbox"  name="overlays__bottom_left__over_the_picture">
                                <label class="label-inline" for="overlays__bottom_left__over_the_picture">Dentro il perimetro della foto</label>
                                <br>                    
                            </div>
                        </div>
                    </div>
                </div>
            </div>

     <!-------------------------------------------------------------------------->
             
            <div class="center">
                <input id="save" class="button-primary" type="submit" value="Salva">
            </div>     
        </form>
       
    </div>
</div>

<script>
    // Figures out the endpoint URL and mode of operation (local/remote)
    const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf("/"));
    const url = baseUrl.substring(0, baseUrl.lastIndexOf("/")+1); 
    const localMode = url.startsWith("file://");
    const form = document.getElementById('config');
    form.reset();
    
    // Hooks on the configFile filepicker to load the configuration file if in local mode
    document.getElementById('configFile').addEventListener('change', function selectedFileChanged() {
        form.reset();
        loadDataFromFile(this);
    });
    
    // Hooks on the image filepickers to load the image preview if in local mode
    document.querySelectorAll('.image-picker').forEach((item) => {
        item.addEventListener('change', function selectedFileChanged() {
            loadLocalImage(this);
        });
    })
    
    // Checkboxes with the same name should always have the same value.
    document.querySelectorAll('input[type="checkbox"]').forEach((item) => {
        item.addEventListener('change', function selectedFileChanged() {
            document.querySelectorAll('input[name="'+item.name+'"]').forEach((sameItem) => {
                sameItem.checked = item.checked;
            });
        });
    })
    
    // Hooks on the Save button click event to trigger the save operation
    form.onsubmit = async (e) => {
        e.preventDefault();
        var button = document.getElementById("save");
        button.disabled = true;
        button.value = "Sto salvando...";
        saveConfiguration(url);
        button.disabled = false;
        button.value = "Salva";
    }
    
    // Loads the data at the start
    var last_loaded_data = null;
    if (localMode){
        document.getElementsByClassName("sky")[0].classList.add("dark-sky");
        document.getElementById('loading').style.display = "none";
        document.getElementById('loading-local').style.display = "block";
    } else {
        document.getElementsByClassName("sky")[0].classList.add("light-sky");
        loadDataFromServer(url);
    }
</script>

</body>
</html>
